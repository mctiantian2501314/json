name: Auto Sync JSON Files

on:
  push:
    paths:
      - '*.json'      # ä»…å½“æ ¹ç›®å½• JSON æ–‡ä»¶å˜åŒ–æ—¶è§¦å‘
    branches:
      - main           # æ ¹æ®å®žé™…æƒ…å†µä¿®æ”¹åˆ†æ”¯åç§°

jobs:
  sync-json:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # éœ€è¦å†™æƒé™æäº¤å˜æ›´

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # èŽ·å–å®Œæ•´æäº¤åŽ†å²

    - name: Ensure SY directory
      run: mkdir -p SY

    - name: Migrate JSON files
      run: |
        # ç§»åŠ¨æ ¹ç›®å½•æ‰€æœ‰ JSON æ–‡ä»¶ï¼ˆä¸åŒ…å«å­ç›®å½•ï¼‰
        find . -maxdepth 1 -name "*.json" -exec mv {} SY/ \; || true
        
        # æ˜¾ç¤ºæ“ä½œç»“æžœï¼ˆè°ƒè¯•ç”¨ï¼‰
        echo "è¿ç§»åŽçš„æ–‡ä»¶åˆ—è¡¨ï¼š"
        ls -l SY/

    - name: Commit changes
      id: commit
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        # æ£€æµ‹æ˜¯å¦æœ‰å˜æ›´
        if git diff --quiet; then
          echo "æ²¡æœ‰éœ€è¦æäº¤çš„å˜æ›´"
          exit 0
        else
          git add .
          git commit -m "ðŸ”§ Auto sync JSON files to SY directory"
          echo "changes=true" >> $GITHUB_OUTPUT
        fi

    - name: Push changes
      if: steps.commit.outputs.changes == 'true'
      run: git push
