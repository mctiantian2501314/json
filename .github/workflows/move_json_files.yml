name: Auto Sync JSON Files

on:
  push:
    paths:
      - '*.json'      # 仅当根目录 JSON 文件变化时触发
    branches:
      - main           # 根据实际情况修改分支名称

jobs:
  sync-json:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # 需要写权限提交变更

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # 获取完整提交历史

    - name: Ensure SY directory
      run: mkdir -p SY

    - name: Migrate JSON files
      run: |
        # 移动根目录所有 JSON 文件（不包含子目录）
        find . -maxdepth 1 -name "*.json" -exec mv {} SY/ \; || true
        
        # 显示操作结果（调试用）
        echo "迁移后的文件列表："
        ls -l SY/

    - name: Commit changes
      id: commit
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        # 检测是否有变更
        if git diff --quiet; then
          echo "没有需要提交的变更"
          exit 0
        else
          git add .
          git commit -m "🔧 Auto sync JSON files to SY directory"
          echo "changes=true" >> $GITHUB_OUTPUT
        fi

    - name: Push changes
      if: steps.commit.outputs.changes == 'true'
      run: git push
